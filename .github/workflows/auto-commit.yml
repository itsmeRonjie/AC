name: Auto Commit Every 5 Minutes
on:
  schedule:
    - cron: '*/1 * * * *'  # Runs every 5 minutes
jobs:
  commit:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required to commit and push changes
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: false  # Avoid using default token for push
          fetch-depth: 0  # Full history for proper git operations
      - name: Update file
        run: |
          FILE="auto_commit_log.md"
          if [ ! -f "$FILE" ]; then
            echo "# Auto Commit Log" > "$FILE"
            echo "Commit #1 at $(date -u)" >> "$FILE"
          else
            COUNT=$(grep -oP 'Commit #\K\d+' "$FILE" || echo 0)
            NEXT=$((COUNT + 1))
            sed -i "/Commit #/c\Commit #$NEXT at $(date -u)" "$FILE"
          fi
      - name: Commit and push
        run: |
          git config user.name "itsmeRonjie"
          git config user.email "itsmeRonjie@gmail.com"
          git add auto_commit_log.md
          git commit -m "Auto-commit: Update auto_commit_log.md"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
